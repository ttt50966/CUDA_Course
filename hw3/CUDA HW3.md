#CUDA HW3

*Author: D06222003 邱冠嘉*





## Problem 1

| Lattice size |   error   | total iterations | Processing time for CPU (ms) | CPU Glops |
| :----------: | :-------: | :--------------: | ---------------------------: | :-------: |
|   (32,32)    |  0.000e0  |       2606       |                     9.686016 | 1.695000  |
|   (64,64)    | 5.820e-11 |       9745       |                   152.521851 | 1.719219  |
|  (128,128)   |  0.000e0  |      35073       |                  2273.354004 | 1.714530  |
|  (256,256)   | 5.821e-11 |      124611      |                 32721.958984 | 1.719818  |
|  (512,512)   |  0.000e0  |      423553      |                467132.812500 | 1.650843  |

**Table 1.1**: The result of CPU with different lattice size.



| Lattice size | Block size | total iterations (GPU) | Processing time for GPU | GPU Gflops | Total time for GPU |
| ------------ | ---------- | ---------------------- | ----------------------: | ---------- | ------------------ |
| 32           | 4          | 2606                   |               44.078400 | 0.372468   | 44.894913          |
| 32           | 8          | 2606                   |               43.326817 | 0.378929   | 44.145794          |
| 32           | 16         | 2606                   |               44.782242 | 0.366614   | 45.612930          |
| 32           | 32         | 2606                   |               62.370590 | 0.263230   | 63.173088          |
| 64           | 4          | 9745                   |              240.620163 | 1.089761   | 241.455811         |
| 64           | 8          | 9745                   |              234.565979 | 1.117888   | 235.392792         |
| 64           | 16         | 9745                   |              235.896164 | 1.111584   | 236.721725         |
| 64           | 32         | 9746                   |              239.271805 | 1.096015   | 240.112030         |
| **128**      | **4**      | 35073                  |              966.957947 | 4.030923   | **967.864441**     |
| **128**      | **8**      | 35073                  |              804.380798 | 4.845631   | **805.273438**     |
| **128**      | **16**     | 35073                  |              791.038269 | 4.927363   | **791.918762**     |
| **128**      | **32**     | 35073                  |              792.358948 | 4.919150   | **793.185791**     |
| **256**      | **4**      | 124611                 |             5757.869629 | 9.773723   | **5759.052246**    |
| **256**      | **8**      | 124611                 |             3545.399170 | 15.872916  | **3546.588623**    |
| **256**      | **16**     | 124611                 |             3274.562500 | 17.185753  | **3275.761963**    |
| **256**      | **32**     | 124611                 |             4093.542480 | 13.747463  | **4094.747070**    |
| **512**      | **4**      | 423553                 |            61116.113281 | 12.617997  | **61118.785156**   |
| **512**      | **8**      | 423553                 |            28293.888672 | 27.255460  | **28296.533203**   |
| **512**      | **16**     | 423553                 |            24367.263672 | 31.647499  | **24369.925781**   |
| **512**      | **32**     | 423553                 |            26425.638672 | 29.182377  | **26428.294922**   |

**Table 1.2**: The result for GPU using different block sizes.



| Lattice size | Block size | total iterations (GPU) | Processing time for GPU | GPU Gflops | Total time for GPU |
| ------------ | ---------- | ---------------------- | ----------------------: | ---------- | ------------------ |
| 32           | 4          | 2606                   |               59.554878 | 0.275675   | 60.406525          |
| 32           | 8          | 2606                   |               59.648514 | 0.275242   | 60.504417          |
| 32           | 16         | 2606                   |               55.044289 | 0.298265   | 55.894882          |
| 32           | 32         | 2606                   |               77.300735 | 0.212389   | 78.138275          |
| 64           | 4          | 9745                   |              253.233337 | 1.035482   | 254.029236         |
| 64           | 8          | 9745                   |              200.450302 | 1.308147   | 201.237183         |
| 64           | 16         | 9745                   |              259.072296 | 1.012144   | 259.858429         |
| 64           | 32         | 9745                   |              261.221191 | 1.003818   | 261.994720         |
| 128          | 4          | 35073                  |             1171.060547 | 3.328378   | 1171.995117        |
| 128          | 8          | 35073                  |              987.656738 | 3.946445   | 988.588440         |
| 128          | 16         | 35073                  |             1036.819214 | 3.759318   | 1037.734741        |
| 128          | 32         | 35073                  |             1041.529541 | 3.742316   | 1042.465820        |
| 256          | 4          | 124611                 |             6673.728516 | 8.432441   | 6675.068848        |
| 256          | 8          | 124611                 |             4282.142090 | 13.141979  | 4283.412598        |
| 256          | 16         | 124611                 |             3846.298340 | 14.631164  | 3847.516602        |
| **256**      | **32**     | 124611                 |             3887.917480 | 14.474542  | **3889.037109**    |
| **512**      | **4**      | 423553                 |            52999.976562 | 14.550251  | **53002.449219**   |
| **512**      | **8**      | 423553                 |            27398.996094 | 28.145664  | **27401.539062**   |
| **512**      | **16**     | 423553                 |            24285.384766 | 31.754199  | **24288.074219**   |
| **512**      | **32**     | 423553                 |            26002.582031 | 29.657168  | **26005.062500**   |

**Table 1.3**: The result for GPU using different block sizes with texture.

---

### Discussion 1

Compared **Table 1.1** and **Table 1.2**, we could find the total time usage for GPU is shorter when the lattice size become bigger. Besides, the total time varies using different block size. So, we need to tune a suitable block size for optimized performance. *(The bold numbers in **Table 1.2** have better performance than using CPU.)*

**Table 1.3** is using texture for GPU computation, which is not so efficient at small lattice size and small block size. When the lattice becomes bigger, the speed up for texture becomes faster. *(The bold numbers in **Table 1.3** have better performance than without using texture feature.)*

---





## Problem 2

| Lattice size | error    | total iterations | Processing time for CPU | CPU Gflops |
| ------------ | -------- | ---------------- | ----------------------- | ---------- |
| 512          | 2.119e01 | 1000000          | 1059864.875000          | 1.717860   |

**Table 2.1**: The result for CPU calculating the 512*512 square lattice.



| Lattice size | Block size | total iterations (GPU) | Processing time for GPU | GPU Gflops | Total time for GPU |
| ------------ | ---------- | ---------------------- | ----------------------: | ---------- | ------------------ |
| 512          | 256        | 1000000                |            71648.546875 | 25.411541  | 71651.195312       |
| 512          | 128        | 1000000                |            66887.390625 | 27.220377  | 66890.054688       |
| 512          | 64         | 1000000                |            57154.343750 | 31.855846  | 57156.832031       |
| 512          | 32         | 1000000                |            58912.546875 | 30.905131  | 58914.957031       |
| 512          | 16         | 1000000                |            68412.476562 | 26.613567  | 68415.117188       |
| 512          | 8          | 1000000                |            63113.714844 | 28.847930  | 63116.355469       |
| 512          | 2          | 1000000                |            56936.132812 | 31.977936  | 56938.574219       |

**Table 2.2**: The result for GPU calculating.



| Lattice size | Block size | total iterations (GPU) | Processing time for GPU | GPU Gflops | Total time for GPU |
| ------------ | ---------- | ---------------------- | ----------------------: | ---------- | ------------------ |
| 512          | 256        | 1000000                |            64537.093750 | 28.211683  | 64539.769531       |
| 512          | 128        | 1000000                |            64321.937500 | 28.306050  | 64324.628906       |
| 512          | 64         | 1000000                |            64382.675781 | 28.279347  | 64385.316406       |
| 512          | 32         | 1000000                |            64356.964844 | 28.290644  | 64359.652344       |
| 512          | 16         | 1000000                |            63806.328125 | 28.534787  | 63808.972656       |
| 512          | 8          | 1000000                |            60657.066406 | 30.016288  | 60659.511719       |
| 512          | 2          | 1000000                |            64301.441406 | 28.315073  | 64304.097656       |

**Table 2.3**: The result for GPU calculating with texture.

---

###Discussion 2

Checking **Table 2.1**, **Table 2.2** and **Table 2.3**, the lattice size may be too big (512*512), so that it reached the max iterations. I have tried to increase the value of max iterations to "10,000,000". Unfortunately, it didn't help. It still reached the new max iterations. Besides, the initial and the final matrixes are too big and costing too much time, I stop increasing max iterations.

---



## Problem 3

| Lattice size  |   error   | total iterations | Processing time for CPU (ms) | CPU Glops |
| :-----------: | :-------: | :--------------: | ---------------------------: | :-------: |
|  (32,32,32)   |  0.000e0  |       2946       |                   530.560364 | 1.349287  |
|  (64,64,64)   | 5.378e-11 |      10899       |                 18712.992188 | 1.249283  |
| (128,128,128) | 5.821e-11 |      41098       |                627396.875000 | 1.179322  |

**Table 3.1**: The result for CPU calculating the cubic lattice.



| Lattice size | Block size | total iterations (GPU) | Processing time for GPU | GPU Gflops | Total time for GPU |
| ------------ | ---------- | ---------------------- | ----------------------: | ---------: | -----------------: |
| 32           | 2          | 2946                   |              159.637985 |   4.484384 |         160.626434 |
| **32**       | **4**      | 2946                   |               79.356125 |   9.021081 |      **80.336983** |
| **32**       | **8**      | 2946                   |               73.530205 |   9.735836 |      **74.529053** |
| **64**       | **2**      | 10899                  |             3063.366699 |   7.631418 |    **3065.963867** |
| **64**       | **4**      | 10899                  |              885.407043 |  26.403485 |     **888.010193** |
| **64**       | **8**      | 10899                  |              757.401001 |  30.865858 |     **759.966492** |
| **128**      | **2**      | 41098                  |            79631.039062 |   9.291642 |   **79640.671875** |
| **128**      | **4**      | 41098                  |            20237.408203 |  36.561158 |   **20247.449219** |
| **128**      | **8**      | 41098                  |            15026.566406 |  49.239664 |   **15035.583008** |

**Table 3.2**: The result for GPU calculating.



| Lattice size | Block size | total iterations (GPU) | Processing time for GPU | GPU Gflops | Total time for GPU |
| ------------ | ---------- | ---------------------- | ----------------------: | ---------: | -----------------: |
| **32**       | **2**      | 2946                   |              150.707397 |   4.750119 |     **151.723434** |
| 32           | 4          | 2946                   |               92.755135 |   7.717934 |          93.759651 |
| 32           | 8          | 2956                   |               82.101379 |   8.749037 |          83.034470 |
| **64**       | **2**      | 10899                  |             2491.556152 |   9.382824 |    **2493.969482** |
| **64**       | **4**      | 10899                  |              735.661072 |  31.777992 |     **738.061707** |
| **64**       | **8**      | 10899                  |              736.864197 |  31.726106 |     **739.498413** |
| **128**      | **2**      | 41098                  |             69535.21094 |  10.640696 |    **69544.97656** |
| **128**      | **4**      | 41098                  |             16047.71680 |  46.106439 |     **16057.8457** |
| **128**      | **8**      | 41098                  |             13689.07227 |  54.050637 |    **13699.35254** |

**Table 3.3**: The result for GPU calculating with texture.

---

### Discussion 3

Similar situation with Problem 1, it is faster using GPU than CPU. Also, using texture feature for GPU is faster than without it when the lattice size becomes bigger.

---